---
title: "p8105_hw2_raj2152"
author: "Rachelle Juan"
date: "10/9/2021"
output: github_document
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
library(haven)
```

# Problem 1

Importing and cleaning the Mr. Trash Wheel sheet.
```{r}
trashwheel_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "Mr. Trash Wheel",
    range = "A2:N408"
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(across(sports_balls, round, 0))
```

Read and clean precipitation data for 2018 and 2019. 
```{r}
precip18_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2018 Precipitation",
    range = "A2:B14"
  ) %>% 
  janitor::clean_names() %>% 
  rename(total_precipitation = total) %>% 
  mutate(year = "2018") %>% 
  drop_na(total_precipitation)  
  

precip19_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2019 Precipitation",
    range = "A2:B14"
  ) %>% 
  janitor::clean_names() %>% 
  rename(total_precipitation = total) %>% 
  mutate(year = "2019") %>% 
  drop_na(total_precipitation) 
```

Merge 2018 and 2019 precipitation datasets.
```{r}
precip_tidy =
  bind_rows(precip18_df, precip19_df) %>% 
  janitor::clean_names() %>% 
  mutate(month = month.name[month])

precip_tidy
```

About these data...
```{r, results = FALSE}
skimr::skim(trashwheel_df)
trash19_df = filter(trashwheel_df, year == "2019")
median(pull(trash19_df, sports_balls))

skimr::skim(precip18_df)
skimr::skim(precip19_df)
skimr::skim(precip_tidy)
sum(pull(precip18_df, total_precipitation))
```

### About Mr. Trash Wheel
There were 344 observations and 14 variables in the Mr. Trash Wheel dataset. The variables identified the date of operation for specific dumpsters and measured the total weight and volume of trash collected. There are also separate variables indicating the count of item types collected -- for example, plastic and glass bottles, grocery bags, cigarette butts, etc. The variable 'homes powered' also provided a count of homes powered by the trash from Mr. Trash Wheel. The median number of sports balls in a dumpster in 2019 was 8.5 sports balls. 

### About 2018 & 2019 Precipitation Data
The total precipitation for 2018 was 70.33 inches. 2018 had 12 observations and 2019 had 6 observations. In 2018, the average precipitation was 5.86 inches. In 2019, the average precipitation was 2.78 inches. The key variables were month and total precipitation in inches. The resulting merged dataset, thus, shows 18 total observations for total precipitation in inches with a monthly average precipitation total of 4.83 inches. 


## Problem 2

First, clean pols_month.csv data:
```{r, message = FALSE}
pols_month_df = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year","month","day"), sep = "-") %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    month = str_to_lower(month),
    year = as.numeric(year),
    prez_gop = replace(prez_gop, prez_gop == "1", "gop"),
    prez_gop = replace(prez_gop, prez_gop == "0", "dem"),
    ) %>% 
  rename(president = prez_gop) %>% 
  select(-prez_dem, -day)
```

Second, clean snp.csv data:
```{r, message = FALSE}
snp_df =
  read_csv("./fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = as.Date(date, "%m/%d/%y")) %>% 
  separate(date, into = c("year","month","day"), sep = "-") %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    month = str_to_lower(month),
    year = as.numeric(year),
    year = ifelse(year > 2021, year - 100, year)
    ) %>% 
  select(-day) %>% 
  arrange(year, month) 
```

Third, clean unemployment data:
```{r, message = FALSE}
unemp_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "percent_unemp"
  ) %>% 
  mutate(
    month = match(month, tolower(month.abb)),
    month = month.name[month],
    month = str_to_lower(month)
    ) %>% 
  arrange(year, month) 
```

Merge together pols_month.csv and snp.csv, then merge with unemployment.csv

```{r}
merged_df =
  bind_rows(pols_month_df, snp_df)

merged2_df =
  bind_rows(merged_df, unemp_df)
```

### About the FiveThirtyEight datasets...
```{r, eval = FALSE}
skimr::skim(pols_month_df)
skimr::skim(snp_df)
skimr::skim(unemp_df)
skimr::skim(merged2_df)
min(pull(merged2_df, year))
max(pull(merged2_df, year))
```

`pols_month_df` had 822 observations and 9 columns, and contained information about the number of politicians by political party. This dataset captured information from 1947 to 2015. `snp_df` had 787 observations and 3 columns, and showed the closing values of the S&P stock index on a specified date. This dataset ranged from 1950 to 2015. `unemp_df` had 816 observations and 3 columns, and measured the percentage unemployment per month between 1948 and 2015. The resulting dataset `merged2_df` contains 2425 observations and 11 columns, and ranges from 1947 to 2015. Key variables include the `year` and `month` of observation, `close` indicating the closing S&P values, and `percent_unemp` indicating the percent unemployed at the specified month. 


## Problem 3

Load and tidy popular_baby_names.csv

```{r, message = FALSE}
baby_df = 
  read_csv("./data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    ethnicity = recode(ethnicity, "ASIAN AND PACI" = "ASIAN AND PACIFIC ISLANDER"),
    ethnicity = recode(ethnicity, "BLACK NON HISP" = "BLACK NON HISPANIC"),
    ethnicity = recode(ethnicity, "WHITE NON HISP" = "WHITE NON HISPANIC"),
    gender = str_to_lower(gender),
    ethnicity = str_to_lower(ethnicity),
    childs_first_name = str_to_lower(childs_first_name)
  ) %>% 
  distinct(year_of_birth, ethnicity, childs_first_name, .keep_all = TRUE)
```

Let's look at the name Olivia:

```{r}
olivia_df = 
  filter(baby_df, childs_first_name == "olivia") %>% 
  select(-childs_first_name, -gender, -count) %>% 
  arrange(year_of_birth) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) 

olivia_df %>% 
  knitr::kable(caption = "Table 1. Rank of female name Olivia by ethnicity and year")
```

Find the most popular male baby name based off total count by name:

```{r}
male_df = 
  filter(baby_df, gender == "male") %>% 
  select(-ethnicity, -gender, -rank, -year_of_birth) %>% 
  arrange(count)
```

Jayden is the most popular name. 

```{r}
jayden_df = 
  filter(baby_df, childs_first_name == "jayden") %>% 
  select(-childs_first_name, -gender, -count) %>% 
  arrange(year_of_birth) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) 

jayden_df %>% 
  knitr::kable(caption = "Table 2. Rank of male name Jayden by ethnicity and year")
```

Create scatterplot for white non-hispanic males in 2016.

```{r}
whitemale16_df = 
  filter(baby_df, gender == "male", ethnicity == "white non hispanic", year_of_birth == "2016")

whitemale16_df %>% 
ggplot(aes(x = rank, y = count)) + 
geom_point()
```

