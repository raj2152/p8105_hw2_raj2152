---
title: "p8105_hw2_raj2152"
author: "Rachelle Juan"
date: "10/9/2021"
output: github_document
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
library(haven)
```

# Problem 1

Importing and cleaning the Mr. Trash Wheel sheet.
```{r}
trashwheel_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "Mr. Trash Wheel",
    range = "A2:N408"
  ) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(across(sports_balls, round, 0))
```

Read and clean precipitation data for 2018 and 2019. 
```{r}
precip18_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2018 Precipitation",
    range = "A2:B14"
  ) %>% 
  janitor::clean_names() %>% 
  rename(total_precipitation = total) %>% 
  mutate(year = "2018") %>% 
  drop_na(total_precipitation)  
  

precip19_df = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2019 Precipitation",
    range = "A2:B14"
  ) %>% 
  janitor::clean_names() %>% 
  rename(total_precipitation = total) %>% 
  mutate(year = "2019") %>% 
  drop_na(total_precipitation) 
```

Merge 2018 and 2019 precipitation datasets.
```{r}
precip_tidy =
  bind_rows(precip18_df, precip19_df) %>% 
  janitor::clean_names() %>% 
  mutate(month = month.name[month])

precip_tidy
```


```{r, results = FALSE}
trash19_df = filter(trashwheel_df, year == "2019")
```

### About Mr. Trash Wheel
There were `r nrow(trashwheel_df)` observations and `r ncol(trashwheel_df)` variables in the Mr. Trash Wheel dataset. The variables identified the date of operation for specific dumpsters and measured the total weight and volume of trash collected. There are also separate variables indicating the count of item types collected -- for example, `plastic` and `glass bottles`, `grocery bags`, `cigarette butts`, etc. The variable `homes powered` also provided a count of homes powered by the trash from Mr. Trash Wheel. The median number of sports balls in a dumpster in 2019 was `r round(median(pull(trash19_df, sports_balls)), 0)` sports balls.

### About 2018 & 2019 Precipitation Data
The total precipitation for 2018 was `r sum(pull(precip18_df, total_precipitation))` inches. 2018 had `r nrow(precip18_df)` observations and 2019 had `r nrow(precip19_df)` observations. In 2018, the average precipitation was `r round(mean(pull(precip18_df,total_precipitation)), 2)` inches. In 2019, the average precipitation was `r round(mean(pull(precip19_df,total_precipitation)), 2)` inches. The key variables were `month` and `total_precipitation` in inches. The resulting merged dataset, thus, shows `r nrow(precip_tidy)` total observations for total precipitation in inches with a monthly average precipitation total of `r round(mean(pull(precip_tidy,total_precipitation)), 2)` inches. 


## Problem 2

First, clean pols_month.csv data:
```{r, message = FALSE}
pols_month_df = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year","month","day"), sep = "-") %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    month = str_to_lower(month),
    year = as.numeric(year),
    prez_dem = replace(prez_dem, prez_dem == "1", "dem"),
    prez_dem = replace(prez_dem, prez_dem == "0", "gop"),
    ) %>% 
  rename(president = prez_dem) %>% 
  select(-prez_gop, -day) %>% 
  relocate(year, month, president)
```

Second, clean snp.csv data:
```{r, message = FALSE}
snp_df =
  read_csv("./fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = as.Date(date, "%m/%d/%y")) %>% 
  separate(date, into = c("year","month","day"), sep = "-") %>% 
  arrange(month) %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    month = str_to_lower(month),
    year = as.numeric(year),
    year = ifelse(year > 2021, year - 100, year)
    ) %>% 
  arrange(year) %>% 
  select(-day)
```

Third, clean unemployment data:
```{r, message = FALSE}
unemp_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "percent_unemp"
  ) %>% 
  mutate(
    month = match(month, tolower(month.abb)),
    month = month.name[month],
    month = str_to_lower(month)
    ) %>% 
  arrange(year) 
```

Merge together pols_month.csv and snp.csv, then merge with unemployment.csv

```{r}
merged_df =
  left_join(pols_month_df, snp_df, by = c("year","month"))

merged2_df =
  left_join(merged_df, unemp_df, by = c("year","month"))
```

### About the FiveThirtyEight datasets...

`pols_month_df` had `r nrow(pols_month_df)` observations and `r ncol(pols_month_df)` columns, and contained information about the number of politicians by political party. This dataset captured information from `r min(pull(merged2_df, year))` to `r max(pull(merged2_df, year))`. 
`snp_df` had `r nrow(snp_df)` observations and `r ncol(snp_df)` columns, and showed the closing values of the S&P stock index on a specified date. This dataset ranged from `r min(pull(snp_df, year))` to `r max(pull(snp_df, year))`. 
`unemp_df` had `r nrow(unemp_df)` observations and `r ncol(unemp_df)` columns, and measured the percentage unemployment per month between `r min(pull(unemp_df, year))` and `r max(pull(unemp_df, year))`.

The resulting dataset `merged2_df` contains `r nrow(merged2_df)` observations and `r ncol(merged2_df)` columns, and ranges from `r min(pull(merged2_df, year))` to `r max(pull(merged2_df, year))`. Key variables include the `year` and `month` of observation, `close` indicating the closing S&P values, and `percent_unemp` indicating the percent unemployed at the specified month.


## Problem 3

Load and tidy popular_baby_names.csv

```{r, message = FALSE}
baby_df = 
  read_csv("./data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    ethnicity = recode(ethnicity, "ASIAN AND PACI" = "ASIAN AND PACIFIC ISLANDER"),
    ethnicity = recode(ethnicity, "BLACK NON HISP" = "BLACK NON HISPANIC"),
    ethnicity = recode(ethnicity, "WHITE NON HISP" = "WHITE NON HISPANIC"),
    gender = str_to_lower(gender),
    ethnicity = str_to_lower(ethnicity),
    childs_first_name = str_to_lower(childs_first_name)
  ) %>% 
  distinct(year_of_birth, ethnicity, childs_first_name, .keep_all = TRUE)
```

Let's look at the name Olivia:

```{r}
olivia_df = 
  filter(baby_df, childs_first_name == "olivia") %>% 
  select(-childs_first_name, -gender, -count) %>% 
  arrange(year_of_birth) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) 

olivia_df %>% 
  knitr::kable(caption = "Table 1. Rank of female name Olivia by ethnicity and year")
```

Find the most popular male baby name based off total count by name:

```{r}
male_df =
  filter(baby_df, gender == "male", rank == "1") %>% 
  select(-gender, -count) %>% 
  arrange(year_of_birth) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  ) %>% 
  select(-rank)

male_df %>% 
  knitr::kable(caption = "Table 2. Most popular male names by ethnicity and year")
```

Create scatterplot for white non-hispanic males in 2016.

```{r}
whitemale16_df = 
  filter(baby_df, gender == "male", ethnicity == "white non hispanic", year_of_birth == "2016")

whitemale16_df %>% 
ggplot(aes(x = rank, y = count)) + 
geom_point()
```



